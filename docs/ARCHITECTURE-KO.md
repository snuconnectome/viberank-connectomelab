# Viberank ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ğŸ›ï¸ ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      í´ë¼ì´ì–¸íŠ¸ ê³„ì¸µ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ CLI ë„êµ¬ (npx viberank)                                   â”‚
â”‚  â€¢ MCP Server (Claude Desktop í†µí•©)                          â”‚
â”‚  â€¢ ì›¹ ë¸Œë¼ìš°ì € (Next.js í”„ë¡ íŠ¸ì—”ë“œ)                            â”‚
â”‚  â€¢ curl / API í´ë¼ì´ì–¸íŠ¸                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API ê²Œì´íŠ¸ì›¨ì´ ê³„ì¸µ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Next.js API Routes                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ ê°œì¸ ëª¨ë“œ         â”‚   ì—°êµ¬ì‹¤ ëª¨ë“œ      â”‚                    â”‚
â”‚  â”‚ /api/submit     â”‚   /api/lab/submit â”‚                    â”‚
â”‚  â”‚ /api/profile    â”‚   /api/lab/profileâ”‚                    â”‚
â”‚  â”‚ /api/stats      â”‚   /api/lab/stats  â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                             â”‚
â”‚  â€¢ ë°ì´í„° ê²€ì¦                                               â”‚
â”‚  â€¢ Rate Limiting                                           â”‚
â”‚  â€¢ ì¸ì¦/ì¸ê°€ (OAuth / Header-based)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³„ì¸µ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Convex Serverless Functions                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  submissions.ts                                â”‚        â”‚
â”‚  â”‚  â€¢ ë°ì´í„° ë³‘í•© ë¡œì§                              â”‚        â”‚
â”‚  â”‚  â€¢ ì¤‘ë³µ ì œê±°                                    â”‚        â”‚
â”‚  â”‚  â€¢ ì¼ë³„ breakdown ê³„ì‚°                          â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  stats.ts                                      â”‚        â”‚
â”‚  â”‚  â€¢ ë¦¬ë”ë³´ë“œ ê³„ì‚°                                 â”‚        â”‚
â”‚  â”‚  â€¢ ìˆœìœ„ ê²°ì •                                    â”‚        â”‚
â”‚  â”‚  â€¢ í†µê³„ ì§‘ê³„                                    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  admin.ts                                      â”‚        â”‚
â”‚  â”‚  â€¢ í”Œë˜ê·¸ ê´€ë¦¬                                   â”‚        â”‚
â”‚  â”‚  â€¢ ìŠ¤íŒ¸ ì œê±°                                    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ë°ì´í„° ê³„ì¸µ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Convex Database (ì‹¤ì‹œê°„, ì„œë²„ë¦¬ìŠ¤)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  ê°œì¸ ìŠ¤í‚¤ë§ˆ       â”‚   ì—°êµ¬ì‹¤ ìŠ¤í‚¤ë§ˆ         â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚  submissions     â”‚   labSubmissions     â”‚              â”‚
â”‚  â”‚  profiles        â”‚   labResearchers     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                             â”‚
â”‚  â€¢ ìë™ ì¸ë±ì‹±                                               â”‚
â”‚  â€¢ ì‹¤ì‹œê°„ ì¿¼ë¦¬                                               â”‚
â”‚  â€¢ íŠ¸ëœì­ì…˜ ì§€ì›                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### ê°œì¸ ëª¨ë“œ ìŠ¤í‚¤ë§ˆ

#### submissions í…Œì´ë¸”
```typescript
{
  _id: Id<"submissions">,
  username: string,                    // ì‚¬ìš©ì ì´ë¦„
  githubUsername?: string,             // GitHub ì•„ì´ë””
  githubName?: string,                 // GitHub í‘œì‹œ ì´ë¦„
  githubAvatar?: string,               // GitHub ì•„ë°”íƒ€ URL

  // ì§‘ê³„ ë°ì´í„°
  totalTokens: number,                 // ì´ í† í° ì‚¬ìš©ëŸ‰
  totalCost: number,                   // ì´ ë¹„ìš© ($)
  inputTokens: number,                 // ì…ë ¥ í† í°
  outputTokens: number,                // ì¶œë ¥ í† í°
  cacheCreationTokens: number,         // ìºì‹œ ìƒì„± í† í°
  cacheReadTokens: number,             // ìºì‹œ ì½ê¸° í† í°

  // ê¸°ê°„ ì •ë³´
  dateRange: {
    start: string,                     // YYYY-MM-DD
    end: string                        // YYYY-MM-DD
  },

  // ëª¨ë¸ ì •ë³´
  modelsUsed: string[],                // ["claude-3-5-sonnet", ...]

  // ì¼ë³„ ìƒì„¸ ë°ì´í„°
  dailyBreakdown: Array<{
    date: string,                      // YYYY-MM-DD
    inputTokens: number,
    outputTokens: number,
    cacheCreationTokens: number,
    cacheReadTokens: number,
    totalTokens: number,
    totalCost: number,
    modelsUsed: string[]
  }>,

  // ë©”íƒ€ë°ì´í„°
  submittedAt: number,                 // Unix timestamp
  verified: boolean,                   // ê²€ì¦ ì™„ë£Œ ì—¬ë¶€
  source?: "cli" | "oauth",            // ì œì¶œ ë°©ë²•
  claimedBy?: Id<"profiles">,          // í”„ë¡œí•„ ID
  flaggedForReview?: boolean,          // ë¦¬ë·° í”Œë˜ê·¸
  flagReasons?: string[]               // í”Œë˜ê·¸ ì‚¬ìœ 
}

// ì¸ë±ìŠ¤
- by_total_cost: [totalCost]
- by_total_tokens: [totalTokens]
- by_submitted_at: [submittedAt]
- by_username: [username]
- by_github_username: [githubUsername]
- by_flagged: [flaggedForReview, submittedAt]
```

#### profiles í…Œì´ë¸”
```typescript
{
  _id: Id<"profiles">,
  username: string,                    // ê³ ìœ  ì‚¬ìš©ìëª…
  githubUsername?: string,             // GitHub ê³„ì •
  githubName?: string,                 // í‘œì‹œ ì´ë¦„
  bio?: string,                        // ìê¸°ì†Œê°œ
  avatar?: string,                     // í”„ë¡œí•„ ì´ë¯¸ì§€
  totalSubmissions: number,            // ì´ ì œì¶œ íšŸìˆ˜
  bestSubmission?: Id<"submissions">,  // ìµœê³  ì œì¶œ ID
  createdAt: number                    // Unix timestamp
}

// ì¸ë±ìŠ¤
- by_username: [username]
- by_github: [githubUsername]
```

### ì—°êµ¬ì‹¤ ëª¨ë“œ ìŠ¤í‚¤ë§ˆ (ì„¤ê³„ì•ˆ)

#### labSubmissions í…Œì´ë¸”
```typescript
{
  _id: Id<"labSubmissions">,
  researcherUsername: string,          // ì—°êµ¬ì› ì´ë¦„
  department: string,                  // ì†Œì† ë¶€ì„œ/ë©

  // ì§‘ê³„ ë°ì´í„° (ê°œì¸ ëª¨ë“œì™€ ë™ì¼)
  totalTokens: number,
  totalCost: number,
  inputTokens: number,
  outputTokens: number,
  cacheCreationTokens: number,
  cacheReadTokens: number,

  // ê¸°ê°„ ì •ë³´
  dateRange: {
    start: string,
    end: string
  },

  // ëª¨ë¸ ì •ë³´
  modelsUsed: string[],

  // ì¼ë³„ breakdown
  dailyBreakdown: Array<{
    date: string,
    inputTokens: number,
    outputTokens: number,
    cacheCreationTokens: number,
    cacheReadTokens: number,
    totalTokens: number,
    totalCost: number,
    modelsUsed: string[]
  }>,

  // ë©”íƒ€ë°ì´í„°
  submittedAt: number,
  verified: boolean,
  flaggedForReview?: boolean,
  flagReasons?: string[]
}

// ì¸ë±ìŠ¤
- by_researcher: [researcherUsername]
- by_department: [department]
- by_total_cost: [totalCost]
- by_submitted_at: [submittedAt]
```

#### labResearchers í…Œì´ë¸”
```typescript
{
  _id: Id<"labResearchers">,
  username: string,                    // ì—°êµ¬ì› ì´ë¦„
  department: string,                  // ì†Œì†
  totalSubmissions: number,            // ì´ ì œì¶œ íšŸìˆ˜
  totalTokens: number,                 // ëˆ„ì  í† í°
  totalCost: number,                   // ëˆ„ì  ë¹„ìš©
  firstSubmission: number,             // ì²« ì œì¶œ ì‹œê°
  lastSubmission: number,              // ë§ˆì§€ë§‰ ì œì¶œ ì‹œê°
  createdAt: number
}

// ì¸ë±ìŠ¤
- by_username: [username]
- by_department: [department]
- by_total_tokens: [totalTokens]
- by_total_cost: [totalCost]
```

## ğŸ”„ ë°ì´í„° íë¦„ ìƒì„¸

### ê°œì¸ ëª¨ë“œ ì œì¶œ í”Œë¡œìš°

```
1. í´ë¼ì´ì–¸íŠ¸
   npx viberank
   â†“
   ccusage ì‹¤í–‰ â†’ cc.json ìƒì„±
   â†“
   GitHub ì‚¬ìš©ìëª… í™•ì¸
   â†“
   API í˜¸ì¶œ

2. API Layer (/api/submit)
   â†“
   Rate Limiting ì²´í¬ (ì´ˆë‹¹ 10íšŒ ì œí•œ)
   â†“
   ë°ì´í„° ê²€ì¦
   - í† í° ìˆ˜í•™ ê²€ì¦: input + output + cache = total
   - ë‚ ì§œ ê²€ì¦: ë¯¸ë˜ ë‚ ì§œ ì°¨ë‹¨
   - ìŒìˆ˜ ê°’ ì²´í¬
   - ë¹„ì •ìƒì  ì‚¬ìš©ëŸ‰ ì²´í¬ (ì¼ì¼ $5000, 250M í† í° ì œí•œ)
   â†“
   GitHub username ê²€ì¦

3. Convex Layer
   â†“
   ê¸°ì¡´ ì œì¶œ í™•ì¸
   â†“
   ë°ì´í„° ë³‘í•© ë¡œì§
   - ë‚ ì§œë³„ breakdown ë³‘í•©
   - ì¤‘ë³µ ì œê±°
   - ì´ê³„ ì¬ê³„ì‚°
   â†“
   submissions í…Œì´ë¸”ì— ì €ì¥
   â†“
   profiles í…Œì´ë¸” ì—…ë°ì´íŠ¸
   - totalSubmissions++
   - bestSubmission ê°±ì‹ 

4. ì‘ë‹µ
   â†“
   ì„±ê³µ ë©”ì‹œì§€ + í”„ë¡œí•„ URL ë°˜í™˜
```

### ì—°êµ¬ì‹¤ ëª¨ë“œ ì œì¶œ í”Œë¡œìš°

```
1. í´ë¼ì´ì–¸íŠ¸
   ./submit-lab-usage.sh
   â†“
   ccusage ì‹¤í–‰ â†’ cc.json
   â†“
   í—¤ë” ì„¤ì •:
   - X-Researcher-Username
   - X-Researcher-Department
   â†“
   API í˜¸ì¶œ

2. API Layer (/api/lab/submit)
   â†“
   í—¤ë” ê²€ì¦
   - researcherUsername í•„ìˆ˜
   - department í•„ìˆ˜
   â†“
   Rate Limiting
   â†“
   ë°ì´í„° ê²€ì¦ (ê°œì¸ ëª¨ë“œì™€ ë™ì¼)

3. Convex Layer
   â†“
   ê¸°ì¡´ ì œì¶œ í™•ì¸ (ì—°êµ¬ì› + ê¸°ê°„)
   â†“
   ë°ì´í„° ë³‘í•©
   â†“
   labSubmissions ì €ì¥
   â†“
   labResearchers ì—…ë°ì´íŠ¸
   - ìë™ ìƒì„± (ì—†ìœ¼ë©´)
   - í†µê³„ ê°±ì‹ 

4. ì‘ë‹µ
   â†“
   ì„±ê³µ ë©”ì‹œì§€ + í†µê³„ ë°˜í™˜
```

## ğŸ” ì¸ì¦ ë° ê¶Œí•œ

### ê°œì¸ ëª¨ë“œ
```
ì¸ì¦ ë°©ë²•: GitHub OAuth (NextAuth.js)

í”Œë¡œìš°:
1. ì‚¬ìš©ìê°€ "Sign in with GitHub" í´ë¦­
2. GitHub OAuth í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
3. ì‚¬ìš©ìê°€ ê¶Œí•œ ìŠ¹ì¸
4. Callbackìœ¼ë¡œ ëŒì•„ì˜´
5. NextAuthê°€ ì„¸ì…˜ ìƒì„±
6. JWT í† í° ë°œê¸‰

ê¶Œí•œ ë ˆë²¨:
- ìµëª…: ë¦¬ë”ë³´ë“œ ì¡°íšŒë§Œ
- ë¡œê·¸ì¸: ì œì¶œ + í”„ë¡œí•„ í¸ì§‘
- ê´€ë¦¬ì: í”Œë˜ê·¸ ê´€ë¦¬ + ìŠ¤íŒ¸ ì œê±°
```

### ì—°êµ¬ì‹¤ ëª¨ë“œ
```
ì¸ì¦ ë°©ë²•: í—¤ë” ê¸°ë°˜ (ê°„ì†Œí™”)

í”Œë¡œìš°:
1. í´ë¼ì´ì–¸íŠ¸ê°€ í—¤ë”ì— ì •ë³´ í¬í•¨
   - X-Researcher-Username
   - X-Researcher-Department
2. APIì—ì„œ í—¤ë” ê²€ì¦
3. Rate limitingìœ¼ë¡œ ìŠ¤íŒ¸ ë°©ì§€
4. ë°ì´í„° ê²€ì¦ìœ¼ë¡œ ì¡°ì‘ ë°©ì§€

í–¥í›„ ê°œì„ :
- API í‚¤ ê¸°ë°˜ ì¸ì¦ ì¶”ê°€
- ì—°êµ¬ì‹¤ë³„ ë³„ë„ ì¸ì¦
- IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸
```

## âš¡ ì„±ëŠ¥ ìµœì í™”

### Convex ì¿¼ë¦¬ ìµœì í™”

```typescript
// âŒ ë¹„íš¨ìœ¨ì 
const allSubmissions = await ctx.db.query("submissions").collect();
const sorted = allSubmissions.sort((a, b) => b.totalCost - a.totalCost);
const top100 = sorted.slice(0, 100);

// âœ… ìµœì í™”ë¨
const top100 = await ctx.db
  .query("submissions")
  .withIndex("by_total_cost")
  .order("desc")
  .take(100);
```

### í˜ì´ì§€ë„¤ì´ì…˜

```typescript
// í˜ì´ì§€ ë‹¨ìœ„ ë¡œë”©
export const getLeaderboardPaginated = query({
  args: {
    page: v.number(),
    pageSize: v.number()
  },
  handler: async (ctx, args) => {
    const skip = args.page * args.pageSize;
    return await ctx.db
      .query("submissions")
      .withIndex("by_total_cost")
      .order("desc")
      .skip(skip)
      .take(args.pageSize);
  }
});
```

### Rate Limiting

```typescript
// convex/rateLimiter.ts
const RATE_LIMITS = {
  submit: { requests: 10, window: 60000 },      // 10íšŒ/ë¶„
  query: { requests: 100, window: 60000 }       // 100íšŒ/ë¶„
};

export const checkRateLimit = async (
  ctx: QueryCtx,
  identifier: string,
  action: string
) => {
  const limit = RATE_LIMITS[action];
  const recent = await ctx.db
    .query("rateLimits")
    .withIndex("by_identifier", q =>
      q.eq("identifier", identifier)
        .gt("timestamp", Date.now() - limit.window)
    )
    .collect();

  if (recent.length >= limit.requests) {
    throw new Error("Rate limit exceeded");
  }

  await ctx.db.insert("rateLimits", {
    identifier,
    action,
    timestamp: Date.now()
  });
};
```

## ğŸ” ë°ì´í„° ê²€ì¦ ë¡œì§

### í† í° ê³„ì‚° ê²€ì¦

```typescript
function validateTokenMath(data: UsageData): boolean {
  const calculatedTotal =
    data.inputTokens +
    data.outputTokens +
    data.cacheCreationTokens +
    data.cacheReadTokens;

  const tolerance = 0.01; // 1% í—ˆìš© ì˜¤ì°¨
  const diff = Math.abs(calculatedTotal - data.totalTokens);
  const ratio = diff / data.totalTokens;

  return ratio <= tolerance;
}
```

### ë‚ ì§œ ê²€ì¦

```typescript
function validateDates(dateRange: DateRange): boolean {
  const start = new Date(dateRange.start);
  const end = new Date(dateRange.end);
  const now = new Date();

  // ë¯¸ë˜ ë‚ ì§œ ì°¨ë‹¨
  if (end > now) return false;

  // startê°€ endë³´ë‹¤ ë‚˜ì¤‘ì´ë©´ ì•ˆë¨
  if (start > end) return false;

  // ë‚ ì§œ í˜•ì‹ ê²€ì¦
  if (isNaN(start.getTime()) || isNaN(end.getTime())) {
    return false;
  }

  return true;
}
```

### ë¹„ì •ìƒ ì‚¬ìš©ëŸ‰ ê²€ì¶œ

```typescript
function detectAnomalousUsage(data: UsageData): string[] {
  const flags: string[] = [];

  const daysInRange = getDayCount(data.dateRange);
  const dailyAvgCost = data.totalCost / daysInRange;
  const dailyAvgTokens = data.totalTokens / daysInRange;

  // ì¼ì¼ ë¹„ìš©ì´ $5000 ì´ˆê³¼
  if (dailyAvgCost > 5000) {
    flags.push("Unusually high daily cost");
  }

  // ì¼ì¼ í† í°ì´ 250M ì´ˆê³¼
  if (dailyAvgTokens > 250_000_000) {
    flags.push("Unusually high daily tokens");
  }

  // í† í°ë‹¹ ë¹„ìš© ë¹„ìœ¨ ì²´í¬
  const costPerToken = data.totalCost / data.totalTokens;
  if (costPerToken < 0.000001 || costPerToken > 0.1) {
    flags.push("Unusual cost-per-token ratio");
  }

  // ìŒìˆ˜ ê°’ ì²´í¬
  if (data.totalTokens < 0 || data.totalCost < 0 ||
      data.inputTokens < 0 || data.outputTokens < 0) {
    flags.push("Negative values detected");
  }

  return flags;
}
```

## ğŸ“ˆ í™•ì¥ì„± ê³ ë ¤ì‚¬í•­

### ìˆ˜í‰ í™•ì¥
- ConvexëŠ” ìë™ìœ¼ë¡œ ìŠ¤ì¼€ì¼ë§
- API RoutesëŠ” Vercel Edge Functionsë¡œ ì „ì„¸ê³„ ë°°í¬
- ì •ì  ì—ì…‹ì€ CDN ìºì‹±

### ë°ì´í„° ì¦ê°€ ëŒ€ì‘
- ì¸ë±ìŠ¤ ìµœì í™”ë¡œ ì¿¼ë¦¬ ì†ë„ ìœ ì§€
- ì•„ì¹´ì´ë¹™ ì „ëµ (6ê°œì›” ì´ìƒ ë°ì´í„°)
- í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ëŒ€ìš©ëŸ‰ ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬

### ë¹„ìš© ìµœì í™”
- Convex ë¬´ë£Œ í‹°ì–´: 1M í•¨ìˆ˜ í˜¸ì¶œ/ì›”
- Vercel ë¬´ë£Œ í‹°ì–´: 100GB ëŒ€ì—­í­/ì›”
- ìºì‹±ìœ¼ë¡œ ì¤‘ë³µ ì¿¼ë¦¬ ë°©ì§€

## ğŸ”® í–¥í›„ ê°œì„  ê³„íš

### ë‹¨ê¸° (1-2ì£¼)
- [ ] ì—°êµ¬ì‹¤ ëª¨ë“œ í”„ë¡ íŠ¸ì—”ë“œ UI
- [ ] ì—°êµ¬ì‹¤ ëŒ€ì‹œë³´ë“œ
- [ ] Docker Compose ì„¤ì •
- [ ] E2E í…ŒìŠ¤íŠ¸

### ì¤‘ê¸° (1-2ê°œì›”)
- [ ] ì—°êµ¬ì‹¤ë³„ í…Œë§ˆ ì»¤ìŠ¤í„°ë§ˆì´ì§•
- [ ] ê³ ê¸‰ í†µê³„ (ì‹œê°„ëŒ€ë³„, ìš”ì¼ë³„ ë¶„ì„)
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ (ì¼ì¼/ì£¼ê°„ ë¦¬í¬íŠ¸)
- [ ] Export ê¸°ëŠ¥ (CSV, PDF)

### ì¥ê¸° (3ê°œì›”+)
- [ ] ë‹¤êµ­ì–´ ì§€ì›
- [ ] ëª¨ë°”ì¼ ì•±
- [ ] Slack/Discord í†µí•©
- [ ] AI ê¸°ë°˜ ì‚¬ìš© íŒ¨í„´ ë¶„ì„
